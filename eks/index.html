


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This training material is part of <b>ITII 3 - Cloud Computing Course</b> for <b>YNCREA Toulon.</b> <br><br> <i>The course takes place over two days and intends to give students an overview of all technologies that are evolving around Continuous Integration and Delivery with a special focus on Cloud Technologies.</i>">
      
      
      
      <link rel="shortcut icon" href="../files/yncrea.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.1.5">
    
    
      
        <title>AWS - EKS Lab - Yncrea - Intro to Cloud Computing Course</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f6cf1dc9.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.85bb4ebe.min.css">
      
      
        
        
        <meta name="theme-color" content="#00bdd6">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","None","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#eks-lab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Yncrea - Intro to Cloud Computing Course" class="md-header-nav__button md-logo" aria-label="Yncrea - Intro to Cloud Computing Course">
      
  <img src="../files/yncrea.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Yncrea - Intro to Cloud Computing Course
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              AWS - EKS Lab
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jurocknsail/yncrea-cloudcomputing-code-labs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Corrections
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
    
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../prerequisites/" class="md-tabs__link">
        Day#1
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
        
      
      <a href="../aws/" class="md-tabs__link md-tabs__link--active">
        Day#2
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../further/" class="md-tabs__link">
        Going Further
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Yncrea - Intro to Cloud Computing Course" class="md-nav__button md-logo" aria-label="Yncrea - Intro to Cloud Computing Course">
      
  <img src="../files/yncrea.png" alt="logo">

    </a>
    Yncrea - Intro to Cloud Computing Course
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jurocknsail/yncrea-cloudcomputing-code-labs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Corrections
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      Day#1
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Day#1" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Day#1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../prerequisites/" class="md-nav__link">
      Env - Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../javaspringboot/" class="md-nav__link">
      Code - SpringBoot Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../maven/" class="md-nav__link">
      Code - Get Started with Maven
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" class="md-nav__link">
      Docker - Containers Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubernetes/" class="md-nav__link">
      Kubernetes - Charts Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../github/" class="md-nav__link">
      Github - Git Repository Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../github-actions/" class="md-nav__link">
      Github - Actions Lab / CI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      Day#2
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Day#2" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Day#2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws/" class="md-nav__link">
      AWS - Basics Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cloudformation/" class="md-nav__link">
      AWS - CloudFormation with Github Actions / CD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ecs/" class="md-nav__link">
      AWS - ECS Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cfn-nag/" class="md-nav__link">
      AWS - CloudFormation Linting
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        AWS - EKS Lab
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      AWS - EKS Lab
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#eks-cluster-deployment" class="md-nav__link">
    EKS Cluster Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kubectl" class="md-nav__link">
    Configure Kubectl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chart-deployment" class="md-nav__link">
    Chart deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-action" class="md-nav__link">
    Github Action
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#followup-exercise" class="md-nav__link">
    Followup Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cleanup/" class="md-nav__link">
      AWS - Cleanup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      Going Further
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Going Further" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Going Further
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../further/" class="md-nav__link">
      Ideas
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#eks-cluster-deployment" class="md-nav__link">
    EKS Cluster Deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-kubectl" class="md-nav__link">
    Configure Kubectl
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chart-deployment" class="md-nav__link">
    Chart deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-action" class="md-nav__link">
    Github Action
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#followup-exercise" class="md-nav__link">
    Followup Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="eks-lab">EKS Lab</h1>
<p>You have already experimented with a local Kubernetes installation in the form of Minikube.<br />
In the next step, we will set up a managed Kubernetes on AWS.<br />
For this, we will use <strong>EKS</strong>, the <a href="https://aws.amazon.com/eks/?nc1=h_ls">Elastic Kubernetes Service</a>.  </p>
<p>This diagram shows how EKS works :
<img alt="EKS" src="../files/eks/eks.JPG" title="EKS" /></p>
<hr />
<h2 id="eks-cluster-deployment">EKS Cluster Deployment</h2>
<p>To facilitate the instantiation of Kubernetes, we will use <mark class="critic">eksctl</mark>, a command line tool interact with Kubernetes.  </p>
<p>To install it, please follow the guidelines <a href="https://eksctl.io/introduction/#installation">here</a>.</p>
<p>After the installation, please download the following file:</p>
<ul>
<li><a href="../files/eks/eks-cluster.yaml">eks-cluster.yaml</a>  </li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>It is absolutely necessary that you use the file above for cluster definition. <br />
The AWS Educate has certain limitations that makes the "standard" installation fail.</p>
</div>
<p>You can then instantiate an EKS cluster by simply executing the following command:</p>
<p><code>eksctl create cluster -f src/infra/eks-cluster.yaml</code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use <code>--profile</code> same as in <code>aws</code> commands to specify a specific profile if you have several AWS Accounts.</p>
</div>
<hr />
<h2 id="configure-kubectl">Configure Kubectl</h2>
<p>Amazon EKS uses the aws eks get-token command, available in version 1.18.49 or later of the AWS CLI or the <a href="https://github.com/kubernetes-sigs/aws-iam-authenticator">AWS IAM Authenticator for Kubernetes</a> with kubectl for cluster authentication. If you have installed the AWS CLI on your system, then by default the AWS IAM Authenticator for Kubernetes will use the same credentials that are returned with the following command:</p>
<div class="highlight"><pre><span></span><code>aws sts get-caller-identity
</code></pre></div>
<ol>
<li>
<p>Ensure that you have version 1.18.49 or later of the AWS CLI installed. To install or upgrade the AWS CLI, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">Installing the AWS Command Line Interface</a> in the <em>AWS Command Line Interface User Guide</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your system's Python version must be 2.7.9 or later.<br />
Otherwise, you receive <code>hostname doesn't match</code> errors with AWS CLI calls to Amazon EKS.</p>
</div>
<p>You can check your AWS CLI version with the following command:</p>
<div class="highlight"><pre><span></span><code>aws --version
</code></pre></div>
</li>
<li>
<p>Use the AWS CLI <code>update-kubeconfig</code> command to create or update your kubeconfig for your cluster.</p>
<blockquote>
<p>By default, the resulting configuration file is created at the default kubeconfig path <span><span class="MathJax_Preview"><code>.kube/config</code></span><script type="math/tex"><code>.kube/config</code></script></span> in your home directory or merged with an existing kubeconfig at that location. You can specify another path with the <code>--kubeconfig</code> option.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>aws eks --region &lt;region-code&gt; update-kubeconfig --name &lt;cluster_name&gt;
</code></pre></div>
</li>
<li>
<p>Test your configuration.</p>
<div class="highlight"><pre><span></span><code>kubectl get svc
</code></pre></div>
<p>Output:</p>
<div class="highlight"><pre><span></span><code>NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
svc/kubernetes   ClusterIP   10.100.0.1   &lt;none&gt;        443/TCP   1m
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you receive the error <code>"aws-iam-authenticator": executable file not found in $PATH</code>, your kubectl isn't configured for Amazon EKS. <br />
For more information, see <a href="https://github.com/awsdocs/amazon-eks-user-guide/blob/master/doc_source/install-aws-iam-authenticator.md">Installing <code>aws-iam-authenticator</code></a>.  </p>
</div>
</li>
</ol>
<p>(More details &amp; troubleshooting <a href="https://github.com/awsdocs/amazon-eks-user-guide/blob/master/doc_source/create-kubeconfig.md">here</a>)</p>
<hr />
<h2 id="chart-deployment">Chart deployment</h2>
<ol>
<li>
<p>Install Helm backend service</p>
<ul>
<li>Tiller service account (Tiller is the Helm server-side component) :
    <div class="highlight"><pre><span></span><code>kubectl create serviceaccount tiller --namespace kube-system
</code></pre></div></li>
<li>
<p>Create the service-account.yaml file in your repo
    <div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiller</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div></p>
</li>
<li>
<p>Create the rbac-config.yaml file in your repo
    <div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiller-role-binding</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tiller</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</code></pre></div></p>
</li>
<li>
<p>Run apply commands and helm init</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f src/infra/service-account.yaml

kubectl apply -f src/infra/rbac-config.yaml

helm init --service-account tiller
</code></pre></div>
</li>
<li>
<p>We can see tiller-deploy is a running pod in kube-system namespace : </p>
<div class="highlight"><pre><span></span><code>kubectl get pods --namespace kube-system <span class="p">|</span> grep tiller
tiller-deploy-758bcdc94f-4c77s   <span class="m">0</span>/1     Pending   <span class="m">0</span>          71s

kubectl get pods --namespace kube-system <span class="p">|</span> grep tiller
tiller-deploy-758bcdc94f-4c77s   <span class="m">0</span>/1     Running   <span class="m">0</span>          92s
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Deploy our Chart</p>
<ul>
<li>
<p>Deploy the chart from previous Labs :</p>
<div class="highlight"><pre><span></span><code>helm install --name silly-unicorn src/helm/chart/yncrea-hellomicro
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Helm CLI is using the same config file as Kubectl, nothing to change here to target EKS !</p>
</div>
</li>
<li>
<p>Check running pods / services :</p>
<div class="highlight"><pre><span></span><code>kubectl.exe get pods
NAME                                READY   STATUS    RESTARTS   AGE
yncrea-hellomicro-646cb8c96-5g7td   <span class="m">1</span>/1     Running   <span class="m">0</span>          

kubectl.exe get services
NAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
kubernetes                  ClusterIP   <span class="m">10</span>.100.0.1       &lt;none&gt;        <span class="m">443</span>/TCP        15m
yncrea-hellomicro-service   NodePort    <span class="m">10</span>.100.136.153   &lt;none&gt;        <span class="m">80</span>:30080/TCP   51s
</code></pre></div>
</li>
<li>
<p>Add an <code>Inbound Rule</code> on the Security Group <code>eks-nodegroup</code> to allow TCP traffic from all IPs to your worker node on port <code>30080</code>.</p>
</li>
<li>
<p>Connect to your worker node EC2 instance public DNS Name on port <code>30080</code> and check your micro service is running fine.</p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Congratulations ! You are able to deploy Chart in EKS !</p>
</div>
</li>
</ul>
</li>
</ol>
<hr />
<h2 id="github-action">Github Action</h2>
<p>After the cluster installation, it's time to extend your Github Actions workflow to launch the deployment in Kubernetes.</p>
<p>You'll need to extend your workflow with the following lines:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">aws</span> <span class="n">eks</span> <span class="o">--</span><span class="n">region</span> <span class="o">&lt;</span><span class="n">region</span><span class="o">-</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">update</span><span class="o">-</span><span class="n">kubeconfig</span> <span class="o">--</span><span class="n">name</span> <span class="o">&lt;</span><span class="n">cluster_name</span><span class="o">&gt;</span>

<span class="n">helm</span> <span class="n">upgrade</span> <span class="o">--</span><span class="n">install</span> <span class="n">silly</span><span class="o">-</span><span class="n">unicorn</span> <span class="n">src</span><span class="o">/</span><span class="n">helm</span><span class="o">/</span><span class="n">chart</span><span class="o">/</span><span class="n">yncrea</span><span class="o">-</span><span class="n">hellomicro</span>
</code></pre></div>
</td></tr></table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We won't set up the EKS cluster creation in Github Actions as it is heavy and not useful to deploy / update at each commit.</p>
</div>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Congratulations ! At this point you are able to build and test Docker Images (CI) and use them in a Helm Chart, automatically deployed on AWS EKS (CD) !</p>
</div>
<hr />
<h2 id="followup-exercise">Followup Exercise</h2>
<ul>
<li>
<p>Create a CF file to add the missing Application Load Balancer to your Infra, in order to access your micro service by a fixed DNS Name.</p>
</li>
<li>
<p>Analyze the file <code>cf-all.yaml</code> used in the Cloud Formation Linting chapter. Once you understand everything, deploy it to have your first app example using a Database !</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../cfn-nag/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AWS - CloudFormation Linting
              </div>
            </div>
          </a>
        
        
          <a href="../cleanup/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                AWS - Cleanup
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2020 Julien Berger
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/jurocknsail" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/repository/docker/jurocknsail/yncrea-hellomicro" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/in/julien-berger-0a9671154/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.8caa27b7.min.js"></script>
      <script src="../assets/javascripts/bundle.193efd2f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>